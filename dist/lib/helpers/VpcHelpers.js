"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VpcHelpers = exports.VpcVersion = void 0;
const aws_ec2_1 = require("aws-cdk-lib/aws-ec2");
const aws_cdk_lib_1 = require("aws-cdk-lib");
var VpcVersion;
(function (VpcVersion) {
    VpcVersion[VpcVersion["version1"] = 0] = "version1";
    VpcVersion[VpcVersion["version2"] = 1] = "version2";
})(VpcVersion || (exports.VpcVersion = VpcVersion = {}));
class VpcHelpers {
    static getExistingVpcLookup(scope, id, props) {
        switch (props.version) {
            case VpcVersion.version1:
                return aws_ec2_1.Vpc.fromLookup(scope, 'VPC', {
                    vpcId: aws_cdk_lib_1.Fn.importValue(`${props.environmentName}VPC`),
                });
            case VpcVersion.version2:
            default:
                return aws_ec2_1.Vpc.fromLookup(scope, 'VPC', {
                    vpcId: aws_cdk_lib_1.Fn.importValue(`${props.environmentName}-VpcId`),
                });
        }
    }
    static getExistingVpc(scope, id, props) {
        switch (props.version) {
            case VpcVersion.version1:
                return this.getExistingVpcv1(scope, id, props);
            case VpcVersion.version2:
            default:
                return this.getExistingVpcv2(scope, id, props);
        }
    }
    static getExistingVpcv2(scope, id, props) {
        let privateSubnetName = [
            'Application',
        ];
        let publicSubnetName = [
            'Public',
        ];
        let availabilityZones = [
            "eu-west-2a",
            "eu-west-2b",
            "eu-west-2c"
        ];
        if (props.privateSubnetNames) {
            privateSubnetName = props.privateSubnetNames;
        }
        if (props.publicSubnetNames) {
            publicSubnetName = props.publicSubnetNames;
        }
        if (props.availabilityZones) {
            availabilityZones = props.availabilityZones;
        }
        return aws_ec2_1.Vpc.fromVpcAttributes(scope, id, {
            vpcId: aws_cdk_lib_1.Fn.importValue(`${props.environmentName}-VpcId`),
            availabilityZones: availabilityZones,
            privateSubnetNames: privateSubnetName,
            vpcCidrBlock: aws_cdk_lib_1.Fn.importValue(`${props.environmentName}-VpcCidr`),
            privateSubnetIds: privateSubnetName.flatMap(subnetName => {
                const rtn = [];
                for (let x = 0; x < availabilityZones.length; x++) {
                    rtn.push(aws_cdk_lib_1.Fn.importValue(`${props.environmentName}-${subnetName}Subnet${x + 1}Id`));
                }
                return rtn;
            }),
            privateSubnetRouteTableIds: privateSubnetName.flatMap(subnetName => {
                const rtn = [];
                for (let x = 0; x < availabilityZones.length; x++) {
                    rtn.push(aws_cdk_lib_1.Fn.importValue(`${props.environmentName}-${subnetName}RouteTable${x + 1}Id`));
                }
                return rtn;
            }),
            publicSubnetNames: publicSubnetName,
            publicSubnetIds: publicSubnetName.flatMap(subnetName => {
                const rtn = [];
                for (let x = 0; x < availabilityZones.length; x++) {
                    rtn.push(aws_cdk_lib_1.Fn.importValue(`${props.environmentName}-${subnetName}Subnet${x + 1}Id`));
                }
                return rtn;
            }),
            publicSubnetRouteTableIds: publicSubnetName.flatMap(subnetName => {
                const rtn = [];
                for (let x = 0; x < availabilityZones.length; x++) {
                    rtn.push(aws_cdk_lib_1.Fn.importValue(`${props.environmentName}-${subnetName}RouteTable${x + 1}Id`));
                }
                return rtn;
            }),
        });
    }
    static getExistingVpcv1(scope, id, props) {
        let privateSubnetName = [
            'Application',
            'Database'
        ];
        const maptoLegacyPrivateImportName = {
            'Application': 'App',
            'Database': 'Data'
        };
        let publicSubnetName = [
            'Public',
        ];
        let availabilityZones = [
            "eu-west-1a",
            "eu-west-1b",
            "eu-west-1c"
        ];
        if (props.privateSubnetNames) {
            privateSubnetName = props.privateSubnetNames;
        }
        if (props.publicSubnetNames) {
            publicSubnetName = props.publicSubnetNames;
        }
        if (props.availabilityZones) {
            availabilityZones = props.availabilityZones;
        }
        // noinspection UnnecessaryLocalVariableJS,JSUnusedLocalSymbols
        const vpc = aws_ec2_1.Vpc.fromVpcAttributes(scope, id, {
            vpcId: aws_cdk_lib_1.Fn.importValue(`${props.environmentName}VPC`),
            vpcCidrBlock: aws_cdk_lib_1.Fn.importValue(`${props.environmentName}VPCCIDR`),
            availabilityZones: availabilityZones,
            privateSubnetNames: privateSubnetName,
            privateSubnetIds: privateSubnetName.flatMap(subnetName => {
                const rtn = [];
                for (let x = 0; x < availabilityZones.length; x++) {
                    rtn.push(aws_cdk_lib_1.Fn.importValue(`${props.environmentName}Private${maptoLegacyPrivateImportName[subnetName]}Subnet${x + 1}`));
                }
                return rtn;
            }),
            privateSubnetRouteTableIds: privateSubnetName.flatMap(subnetName => {
                const rtn = [];
                for (let x = 0; x < availabilityZones.length; x++) {
                    rtn.push(aws_cdk_lib_1.Fn.importValue(`${props.environmentName}PrivateRouteTable${x + 1}`));
                }
                return rtn;
            }),
            publicSubnetNames: publicSubnetName,
            publicSubnetIds: publicSubnetName.flatMap(subnetName => {
                const rtn = [];
                for (let x = 0; x < availabilityZones.length; x++) {
                    rtn.push(aws_cdk_lib_1.Fn.importValue(`${props.environmentName}${subnetName}Subnet${x + 1}`));
                }
                return rtn;
            }),
            publicSubnetRouteTableIds: publicSubnetName.flatMap(subnetName => {
                const rtn = [];
                for (let x = 0; x < availabilityZones.length; x++) {
                    rtn.push(aws_cdk_lib_1.Fn.importValue(`${props.environmentName}PrivateRouteTable${x + 1}`));
                }
                return rtn;
            }),
        });
        return vpc;
    }
}
exports.VpcHelpers = VpcHelpers;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVnBjSGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9oZWxwZXJzL1ZwY0hlbHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsaURBQWdEO0FBQ2hELDZDQUFpQztBQUVqQyxJQUFZLFVBR1g7QUFIRCxXQUFZLFVBQVU7SUFDbEIsbURBQVEsQ0FBQTtJQUNSLG1EQUFRLENBQUE7QUFDWixDQUFDLEVBSFcsVUFBVSwwQkFBVixVQUFVLFFBR3JCO0FBZUQsTUFBYSxVQUFVO0lBQ25CLE1BQU0sQ0FBQyxvQkFBb0IsQ0FDdkIsS0FBZ0IsRUFDaEIsRUFBVSxFQUNWLEtBQWdDO1FBRWhDLFFBQVEsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3BCLEtBQUssVUFBVSxDQUFDLFFBQVE7Z0JBQ3BCLE9BQU8sYUFBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFO29CQUNoQyxLQUFLLEVBQUUsZ0JBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxLQUFLLENBQUMsZUFBZSxLQUFLLENBQUM7aUJBQ3ZELENBQUMsQ0FBQztZQUNQLEtBQUssVUFBVSxDQUFDLFFBQVEsQ0FBQztZQUN6QjtnQkFDSSxPQUFPLGFBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRTtvQkFDaEMsS0FBSyxFQUFFLGdCQUFFLENBQUMsV0FBVyxDQUFDLEdBQUcsS0FBSyxDQUFDLGVBQWUsUUFBUSxDQUFDO2lCQUMxRCxDQUFDLENBQUM7UUFDWCxDQUFDO0lBRUwsQ0FBQztJQUVELE1BQU0sQ0FBQyxjQUFjLENBQ2pCLEtBQWdCLEVBQ2hCLEVBQVUsRUFDVixLQUEwQjtRQUUxQixRQUFRLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNwQixLQUFLLFVBQVUsQ0FBQyxRQUFRO2dCQUNwQixPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ25ELEtBQUssVUFBVSxDQUFDLFFBQVEsQ0FBQztZQUN6QjtnQkFDSSxPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZELENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFDLGdCQUFnQixDQUNuQixLQUFnQixFQUNoQixFQUFVLEVBQ1YsS0FBMEI7UUFFMUIsSUFBSSxpQkFBaUIsR0FBRztZQUNwQixhQUFhO1NBQ2hCLENBQUM7UUFDRixJQUFJLGdCQUFnQixHQUFHO1lBQ25CLFFBQVE7U0FDWCxDQUFDO1FBQ0YsSUFBSSxpQkFBaUIsR0FBRztZQUNwQixZQUFZO1lBQ1osWUFBWTtZQUNaLFlBQVk7U0FDZixDQUFDO1FBQ0YsSUFBSSxLQUFLLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMzQixpQkFBaUIsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUM7UUFDakQsQ0FBQztRQUNELElBQUksS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDMUIsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLGlCQUFpQixDQUFDO1FBQy9DLENBQUM7UUFDRCxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzFCLGlCQUFpQixHQUFHLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQztRQUNoRCxDQUFDO1FBRUQsT0FBTyxhQUFHLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRTtZQUNwQyxLQUFLLEVBQUUsZ0JBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxLQUFLLENBQUMsZUFBZSxRQUFRLENBQUM7WUFDdkQsaUJBQWlCLEVBQUUsaUJBQWlCO1lBQ3BDLGtCQUFrQixFQUFFLGlCQUFpQjtZQUNyQyxZQUFZLEVBQUUsZ0JBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxLQUFLLENBQUMsZUFBZSxVQUFVLENBQUM7WUFDaEUsZ0JBQWdCLEVBQUUsaUJBQWlCLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUNyRCxNQUFNLEdBQUcsR0FBYSxFQUFFLENBQUE7Z0JBQ3hCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztvQkFDaEQsR0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBRSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxlQUFlLElBQUksVUFBVSxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7Z0JBQ3RGLENBQUM7Z0JBQ0QsT0FBTyxHQUFHLENBQUE7WUFDZCxDQUFDLENBQUM7WUFDRiwwQkFBMEIsRUFBRSxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7Z0JBQy9ELE1BQU0sR0FBRyxHQUFhLEVBQUUsQ0FBQTtnQkFDeEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUNoRCxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFFLENBQUMsV0FBVyxDQUFDLEdBQUcsS0FBSyxDQUFDLGVBQWUsSUFBSSxVQUFVLGFBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtnQkFDMUYsQ0FBQztnQkFDRCxPQUFPLEdBQUcsQ0FBQTtZQUNkLENBQUMsQ0FBQztZQUNGLGlCQUFpQixFQUFFLGdCQUFnQjtZQUNuQyxlQUFlLEVBQUUsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUNuRCxNQUFNLEdBQUcsR0FBYSxFQUFFLENBQUE7Z0JBQ3hCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztvQkFDaEQsR0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBRSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxlQUFlLElBQUksVUFBVSxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7Z0JBQ3RGLENBQUM7Z0JBQ0QsT0FBTyxHQUFHLENBQUE7WUFDZCxDQUFDLENBQUM7WUFDRix5QkFBeUIsRUFBRSxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7Z0JBQzdELE1BQU0sR0FBRyxHQUFhLEVBQUUsQ0FBQTtnQkFDeEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUNoRCxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFFLENBQUMsV0FBVyxDQUFDLEdBQUcsS0FBSyxDQUFDLGVBQWUsSUFBSSxVQUFVLGFBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtnQkFDMUYsQ0FBQztnQkFDRCxPQUFPLEdBQUcsQ0FBQTtZQUNkLENBQUMsQ0FBQztTQUNMLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxNQUFNLENBQUMsZ0JBQWdCLENBQ25CLEtBQWdCLEVBQ2hCLEVBQVUsRUFDVixLQUEwQjtRQUUxQixJQUFJLGlCQUFpQixHQUFHO1lBQ3BCLGFBQWE7WUFDYixVQUFVO1NBQ2IsQ0FBQztRQUNGLE1BQU0sNEJBQTRCLEdBRTlCO1lBQ0EsYUFBYSxFQUFFLEtBQUs7WUFDcEIsVUFBVSxFQUFFLE1BQU07U0FDckIsQ0FBQTtRQUVELElBQUksZ0JBQWdCLEdBQUc7WUFDbkIsUUFBUTtTQUNYLENBQUM7UUFDRixJQUFJLGlCQUFpQixHQUFHO1lBQ3BCLFlBQVk7WUFDWixZQUFZO1lBQ1osWUFBWTtTQUNmLENBQUM7UUFDRixJQUFJLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1lBQzNCLGlCQUFpQixHQUFHLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztRQUNqRCxDQUFDO1FBQ0QsSUFBSSxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUMxQixnQkFBZ0IsR0FBRyxLQUFLLENBQUMsaUJBQWlCLENBQUM7UUFDL0MsQ0FBQztRQUNELElBQUksS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDMUIsaUJBQWlCLEdBQUcsS0FBSyxDQUFDLGlCQUFpQixDQUFDO1FBQ2hELENBQUM7UUFFRCwrREFBK0Q7UUFDL0QsTUFBTSxHQUFHLEdBQUcsYUFBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUU7WUFDekMsS0FBSyxFQUFFLGdCQUFFLENBQUMsV0FBVyxDQUFDLEdBQUcsS0FBSyxDQUFDLGVBQWUsS0FBSyxDQUFDO1lBQ3BELFlBQVksRUFBRSxnQkFBRSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxlQUFlLFNBQVMsQ0FBQztZQUMvRCxpQkFBaUIsRUFBRSxpQkFBaUI7WUFDcEMsa0JBQWtCLEVBQUUsaUJBQWlCO1lBQ3JDLGdCQUFnQixFQUFFLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRTtnQkFDckQsTUFBTSxHQUFHLEdBQWEsRUFBRSxDQUFBO2dCQUN4QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQ2hELEdBQUcsQ0FBQyxJQUFJLENBQUMsZ0JBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxLQUFLLENBQUMsZUFBZSxVQUFVLDRCQUE0QixDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7Z0JBQ3hILENBQUM7Z0JBQ0QsT0FBTyxHQUFHLENBQUE7WUFDZCxDQUFDLENBQUM7WUFDRiwwQkFBMEIsRUFBRSxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7Z0JBQy9ELE1BQU0sR0FBRyxHQUFhLEVBQUUsQ0FBQTtnQkFDeEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUNoRCxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFFLENBQUMsV0FBVyxDQUFDLEdBQUcsS0FBSyxDQUFDLGVBQWUsb0JBQW9CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7Z0JBQ2pGLENBQUM7Z0JBQ0QsT0FBTyxHQUFHLENBQUE7WUFDZCxDQUFDLENBQUM7WUFDRixpQkFBaUIsRUFBRSxnQkFBZ0I7WUFDbkMsZUFBZSxFQUFFLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRTtnQkFDbkQsTUFBTSxHQUFHLEdBQWEsRUFBRSxDQUFBO2dCQUN4QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQ2hELEdBQUcsQ0FBQyxJQUFJLENBQUMsZ0JBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxLQUFLLENBQUMsZUFBZSxHQUFHLFVBQVUsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO2dCQUNuRixDQUFDO2dCQUNELE9BQU8sR0FBRyxDQUFBO1lBQ2QsQ0FBQyxDQUFDO1lBQ0YseUJBQXlCLEVBQUUsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUM3RCxNQUFNLEdBQUcsR0FBYSxFQUFFLENBQUE7Z0JBQ3hCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztvQkFDaEQsR0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBRSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxlQUFlLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO2dCQUNqRixDQUFDO2dCQUNELE9BQU8sR0FBRyxDQUFBO1lBQ2QsQ0FBQyxDQUFDO1NBQ0wsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDO0NBQ0o7QUF6S0QsZ0NBeUtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcclxuaW1wb3J0IHsgSVZwYywgVnBjIH0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1lYzJcIjtcclxuaW1wb3J0IHsgRm4gfSBmcm9tIFwiYXdzLWNkay1saWJcIjtcclxuXHJcbmV4cG9ydCBlbnVtIFZwY1ZlcnNpb24ge1xyXG4gICAgdmVyc2lvbjEsXHJcbiAgICB2ZXJzaW9uMlxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIGdldEV4aXN0aW5nVnBjUHJvcHMge1xyXG4gICAgdmVyc2lvbj86IFZwY1ZlcnNpb24sXHJcbiAgICBlbnZpcm9ubWVudE5hbWU6IHN0cmluZ1xyXG4gICAgcHJpdmF0ZVN1Ym5ldE5hbWVzPzogc3RyaW5nW11cclxuICAgIHB1YmxpY1N1Ym5ldE5hbWVzPzogc3RyaW5nW11cclxuICAgIGF2YWlsYWJpbGl0eVpvbmVzPzogc3RyaW5nW11cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBnZXRFeGlzdGluZ1ZwY0xvb2t1cFByb3BzIHtcclxuICAgIHZlcnNpb24/OiBWcGNWZXJzaW9uLFxyXG4gICAgZW52aXJvbm1lbnROYW1lOiBzdHJpbmdcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFZwY0hlbHBlcnMge1xyXG4gICAgc3RhdGljIGdldEV4aXN0aW5nVnBjTG9va3VwKFxyXG4gICAgICAgIHNjb3BlOiBDb25zdHJ1Y3QsXHJcbiAgICAgICAgaWQ6IHN0cmluZyxcclxuICAgICAgICBwcm9wczogZ2V0RXhpc3RpbmdWcGNMb29rdXBQcm9wcyxcclxuICAgICk6IElWcGMge1xyXG4gICAgICAgIHN3aXRjaCAocHJvcHMudmVyc2lvbikge1xyXG4gICAgICAgICAgICBjYXNlIFZwY1ZlcnNpb24udmVyc2lvbjE6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gVnBjLmZyb21Mb29rdXAoc2NvcGUsICdWUEMnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdnBjSWQ6IEZuLmltcG9ydFZhbHVlKGAke3Byb3BzLmVudmlyb25tZW50TmFtZX1WUENgKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjYXNlIFZwY1ZlcnNpb24udmVyc2lvbjI6XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gVnBjLmZyb21Mb29rdXAoc2NvcGUsICdWUEMnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgdnBjSWQ6IEZuLmltcG9ydFZhbHVlKGAke3Byb3BzLmVudmlyb25tZW50TmFtZX0tVnBjSWRgKSxcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldEV4aXN0aW5nVnBjKFxyXG4gICAgICAgIHNjb3BlOiBDb25zdHJ1Y3QsXHJcbiAgICAgICAgaWQ6IHN0cmluZyxcclxuICAgICAgICBwcm9wczogZ2V0RXhpc3RpbmdWcGNQcm9wcyxcclxuICAgICk6IElWcGMge1xyXG4gICAgICAgIHN3aXRjaCAocHJvcHMudmVyc2lvbikge1xyXG4gICAgICAgICAgICBjYXNlIFZwY1ZlcnNpb24udmVyc2lvbjE6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRFeGlzdGluZ1ZwY3YxKHNjb3BlLCBpZCwgcHJvcHMpO1xyXG4gICAgICAgICAgICBjYXNlIFZwY1ZlcnNpb24udmVyc2lvbjI6XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRFeGlzdGluZ1ZwY3YyKHNjb3BlLCBpZCwgcHJvcHMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0RXhpc3RpbmdWcGN2MihcclxuICAgICAgICBzY29wZTogQ29uc3RydWN0LFxyXG4gICAgICAgIGlkOiBzdHJpbmcsXHJcbiAgICAgICAgcHJvcHM6IGdldEV4aXN0aW5nVnBjUHJvcHMsXHJcbiAgICApOiBJVnBjIHtcclxuICAgICAgICBsZXQgcHJpdmF0ZVN1Ym5ldE5hbWUgPSBbXHJcbiAgICAgICAgICAgICdBcHBsaWNhdGlvbicsXHJcbiAgICAgICAgXTtcclxuICAgICAgICBsZXQgcHVibGljU3VibmV0TmFtZSA9IFtcclxuICAgICAgICAgICAgJ1B1YmxpYycsXHJcbiAgICAgICAgXTtcclxuICAgICAgICBsZXQgYXZhaWxhYmlsaXR5Wm9uZXMgPSBbXHJcbiAgICAgICAgICAgIFwiZXUtd2VzdC0yYVwiLFxyXG4gICAgICAgICAgICBcImV1LXdlc3QtMmJcIixcclxuICAgICAgICAgICAgXCJldS13ZXN0LTJjXCJcclxuICAgICAgICBdO1xyXG4gICAgICAgIGlmIChwcm9wcy5wcml2YXRlU3VibmV0TmFtZXMpIHtcclxuICAgICAgICAgICAgcHJpdmF0ZVN1Ym5ldE5hbWUgPSBwcm9wcy5wcml2YXRlU3VibmV0TmFtZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcm9wcy5wdWJsaWNTdWJuZXROYW1lcykge1xyXG4gICAgICAgICAgICBwdWJsaWNTdWJuZXROYW1lID0gcHJvcHMucHVibGljU3VibmV0TmFtZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcm9wcy5hdmFpbGFiaWxpdHlab25lcykge1xyXG4gICAgICAgICAgICBhdmFpbGFiaWxpdHlab25lcyA9IHByb3BzLmF2YWlsYWJpbGl0eVpvbmVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFZwYy5mcm9tVnBjQXR0cmlidXRlcyhzY29wZSwgaWQsIHtcclxuICAgICAgICAgICAgdnBjSWQ6IEZuLmltcG9ydFZhbHVlKGAke3Byb3BzLmVudmlyb25tZW50TmFtZX0tVnBjSWRgKSxcclxuICAgICAgICAgICAgYXZhaWxhYmlsaXR5Wm9uZXM6IGF2YWlsYWJpbGl0eVpvbmVzLFxyXG4gICAgICAgICAgICBwcml2YXRlU3VibmV0TmFtZXM6IHByaXZhdGVTdWJuZXROYW1lLFxyXG4gICAgICAgICAgICB2cGNDaWRyQmxvY2s6IEZuLmltcG9ydFZhbHVlKGAke3Byb3BzLmVudmlyb25tZW50TmFtZX0tVnBjQ2lkcmApLFxyXG4gICAgICAgICAgICBwcml2YXRlU3VibmV0SWRzOiBwcml2YXRlU3VibmV0TmFtZS5mbGF0TWFwKHN1Ym5ldE5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcnRuOiBzdHJpbmdbXSA9IFtdXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGF2YWlsYWJpbGl0eVpvbmVzLmxlbmd0aDsgeCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcnRuLnB1c2goRm4uaW1wb3J0VmFsdWUoYCR7cHJvcHMuZW52aXJvbm1lbnROYW1lfS0ke3N1Ym5ldE5hbWV9U3VibmV0JHt4ICsgMX1JZGApKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ0blxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgcHJpdmF0ZVN1Ym5ldFJvdXRlVGFibGVJZHM6IHByaXZhdGVTdWJuZXROYW1lLmZsYXRNYXAoc3VibmV0TmFtZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBydG46IHN0cmluZ1tdID0gW11cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgYXZhaWxhYmlsaXR5Wm9uZXMubGVuZ3RoOyB4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICBydG4ucHVzaChGbi5pbXBvcnRWYWx1ZShgJHtwcm9wcy5lbnZpcm9ubWVudE5hbWV9LSR7c3VibmV0TmFtZX1Sb3V0ZVRhYmxlJHt4ICsgMX1JZGApKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ0blxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgcHVibGljU3VibmV0TmFtZXM6IHB1YmxpY1N1Ym5ldE5hbWUsXHJcbiAgICAgICAgICAgIHB1YmxpY1N1Ym5ldElkczogcHVibGljU3VibmV0TmFtZS5mbGF0TWFwKHN1Ym5ldE5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcnRuOiBzdHJpbmdbXSA9IFtdXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGF2YWlsYWJpbGl0eVpvbmVzLmxlbmd0aDsgeCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcnRuLnB1c2goRm4uaW1wb3J0VmFsdWUoYCR7cHJvcHMuZW52aXJvbm1lbnROYW1lfS0ke3N1Ym5ldE5hbWV9U3VibmV0JHt4ICsgMX1JZGApKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ0blxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgcHVibGljU3VibmV0Um91dGVUYWJsZUlkczogcHVibGljU3VibmV0TmFtZS5mbGF0TWFwKHN1Ym5ldE5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcnRuOiBzdHJpbmdbXSA9IFtdXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGF2YWlsYWJpbGl0eVpvbmVzLmxlbmd0aDsgeCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcnRuLnB1c2goRm4uaW1wb3J0VmFsdWUoYCR7cHJvcHMuZW52aXJvbm1lbnROYW1lfS0ke3N1Ym5ldE5hbWV9Um91dGVUYWJsZSR7eCArIDF9SWRgKSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBydG5cclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldEV4aXN0aW5nVnBjdjEoXHJcbiAgICAgICAgc2NvcGU6IENvbnN0cnVjdCxcclxuICAgICAgICBpZDogc3RyaW5nLFxyXG4gICAgICAgIHByb3BzOiBnZXRFeGlzdGluZ1ZwY1Byb3BzLFxyXG4gICAgKTogSVZwYyB7XHJcbiAgICAgICAgbGV0IHByaXZhdGVTdWJuZXROYW1lID0gW1xyXG4gICAgICAgICAgICAnQXBwbGljYXRpb24nLFxyXG4gICAgICAgICAgICAnRGF0YWJhc2UnXHJcbiAgICAgICAgXTtcclxuICAgICAgICBjb25zdCBtYXB0b0xlZ2FjeVByaXZhdGVJbXBvcnROYW1lOiB7XHJcbiAgICAgICAgICAgIFtrZXk6IHN0cmluZ106IHN0cmluZ1xyXG4gICAgICAgIH0gPSB7XHJcbiAgICAgICAgICAgICdBcHBsaWNhdGlvbic6ICdBcHAnLFxyXG4gICAgICAgICAgICAnRGF0YWJhc2UnOiAnRGF0YSdcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBwdWJsaWNTdWJuZXROYW1lID0gW1xyXG4gICAgICAgICAgICAnUHVibGljJyxcclxuICAgICAgICBdO1xyXG4gICAgICAgIGxldCBhdmFpbGFiaWxpdHlab25lcyA9IFtcclxuICAgICAgICAgICAgXCJldS13ZXN0LTFhXCIsXHJcbiAgICAgICAgICAgIFwiZXUtd2VzdC0xYlwiLFxyXG4gICAgICAgICAgICBcImV1LXdlc3QtMWNcIlxyXG4gICAgICAgIF07XHJcbiAgICAgICAgaWYgKHByb3BzLnByaXZhdGVTdWJuZXROYW1lcykge1xyXG4gICAgICAgICAgICBwcml2YXRlU3VibmV0TmFtZSA9IHByb3BzLnByaXZhdGVTdWJuZXROYW1lcztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHByb3BzLnB1YmxpY1N1Ym5ldE5hbWVzKSB7XHJcbiAgICAgICAgICAgIHB1YmxpY1N1Ym5ldE5hbWUgPSBwcm9wcy5wdWJsaWNTdWJuZXROYW1lcztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHByb3BzLmF2YWlsYWJpbGl0eVpvbmVzKSB7XHJcbiAgICAgICAgICAgIGF2YWlsYWJpbGl0eVpvbmVzID0gcHJvcHMuYXZhaWxhYmlsaXR5Wm9uZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBub2luc3BlY3Rpb24gVW5uZWNlc3NhcnlMb2NhbFZhcmlhYmxlSlMsSlNVbnVzZWRMb2NhbFN5bWJvbHNcclxuICAgICAgICBjb25zdCB2cGMgPSBWcGMuZnJvbVZwY0F0dHJpYnV0ZXMoc2NvcGUsIGlkLCB7XHJcbiAgICAgICAgICAgIHZwY0lkOiBGbi5pbXBvcnRWYWx1ZShgJHtwcm9wcy5lbnZpcm9ubWVudE5hbWV9VlBDYCksXHJcbiAgICAgICAgICAgIHZwY0NpZHJCbG9jazogRm4uaW1wb3J0VmFsdWUoYCR7cHJvcHMuZW52aXJvbm1lbnROYW1lfVZQQ0NJRFJgKSxcclxuICAgICAgICAgICAgYXZhaWxhYmlsaXR5Wm9uZXM6IGF2YWlsYWJpbGl0eVpvbmVzLFxyXG4gICAgICAgICAgICBwcml2YXRlU3VibmV0TmFtZXM6IHByaXZhdGVTdWJuZXROYW1lLFxyXG4gICAgICAgICAgICBwcml2YXRlU3VibmV0SWRzOiBwcml2YXRlU3VibmV0TmFtZS5mbGF0TWFwKHN1Ym5ldE5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcnRuOiBzdHJpbmdbXSA9IFtdXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGF2YWlsYWJpbGl0eVpvbmVzLmxlbmd0aDsgeCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcnRuLnB1c2goRm4uaW1wb3J0VmFsdWUoYCR7cHJvcHMuZW52aXJvbm1lbnROYW1lfVByaXZhdGUke21hcHRvTGVnYWN5UHJpdmF0ZUltcG9ydE5hbWVbc3VibmV0TmFtZV19U3VibmV0JHt4ICsgMX1gKSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBydG5cclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIHByaXZhdGVTdWJuZXRSb3V0ZVRhYmxlSWRzOiBwcml2YXRlU3VibmV0TmFtZS5mbGF0TWFwKHN1Ym5ldE5hbWUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcnRuOiBzdHJpbmdbXSA9IFtdXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGF2YWlsYWJpbGl0eVpvbmVzLmxlbmd0aDsgeCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcnRuLnB1c2goRm4uaW1wb3J0VmFsdWUoYCR7cHJvcHMuZW52aXJvbm1lbnROYW1lfVByaXZhdGVSb3V0ZVRhYmxlJHt4ICsgMX1gKSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBydG5cclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIHB1YmxpY1N1Ym5ldE5hbWVzOiBwdWJsaWNTdWJuZXROYW1lLFxyXG4gICAgICAgICAgICBwdWJsaWNTdWJuZXRJZHM6IHB1YmxpY1N1Ym5ldE5hbWUuZmxhdE1hcChzdWJuZXROYW1lID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJ0bjogc3RyaW5nW10gPSBbXVxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBhdmFpbGFiaWxpdHlab25lcy5sZW5ndGg7IHgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJ0bi5wdXNoKEZuLmltcG9ydFZhbHVlKGAke3Byb3BzLmVudmlyb25tZW50TmFtZX0ke3N1Ym5ldE5hbWV9U3VibmV0JHt4ICsgMX1gKSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBydG5cclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIHB1YmxpY1N1Ym5ldFJvdXRlVGFibGVJZHM6IHB1YmxpY1N1Ym5ldE5hbWUuZmxhdE1hcChzdWJuZXROYW1lID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJ0bjogc3RyaW5nW10gPSBbXVxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBhdmFpbGFiaWxpdHlab25lcy5sZW5ndGg7IHgrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJ0bi5wdXNoKEZuLmltcG9ydFZhbHVlKGAke3Byb3BzLmVudmlyb25tZW50TmFtZX1Qcml2YXRlUm91dGVUYWJsZSR7eCArIDF9YCkpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcnRuXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB2cGM7XHJcbiAgICB9XHJcbn0iXX0=