"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
require("reflect-metadata");
const dependency_container_framework_1 = require("./framework/dependency-container.framework");
const handler = async (event, context) => {
    // Resolve dependencies from container
    const logger = dependency_container_framework_1.DependencyContainer.resolve('LoggerService');
    const mongoDbClient = dependency_container_framework_1.DependencyContainer.resolve('MongoDbClient');
    const bestPerformersService = dependency_container_framework_1.DependencyContainer.resolve('BestPerformersService');
    logger.setTaskName('LSE-Best-Performers');
    logger.info('LSE Best Performers Lambda started');
    try {
        // Analyze best performers
        const performers = await bestPerformersService.analyzeBestPerformers();
        // Publish results to SNS
        await bestPerformersService.publishBestPerformers(performers);
        return {
            statusCode: 200,
            body: JSON.stringify({
                message: 'Best performers analysis completed',
                count: performers.length
            })
        };
    }
    catch (error) {
        logger.errorMessage(`Error in best performers lambda: ${error}`);
        throw error;
    }
    finally {
        await mongoDbClient.closeConnection();
        logger.info('MongoDB connection closed');
    }
};
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zb2Z0d2FyZS9sYW1iZGEvbHNlLWJlc3QtcGVyZm9ybWVycy9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNEJBQTBCO0FBRTFCLCtGQUFpRjtBQUsxRSxNQUFNLE9BQU8sR0FBRyxLQUFLLEVBQUUsS0FBcUIsRUFBRSxPQUFnQixFQUFFLEVBQUU7SUFDckUsc0NBQXNDO0lBQ3RDLE1BQU0sTUFBTSxHQUFHLG9EQUFtQixDQUFDLE9BQU8sQ0FBZ0IsZUFBZSxDQUFDLENBQUM7SUFDM0UsTUFBTSxhQUFhLEdBQUcsb0RBQW1CLENBQUMsT0FBTyxDQUFnQixlQUFlLENBQUMsQ0FBQztJQUNsRixNQUFNLHFCQUFxQixHQUFHLG9EQUFtQixDQUFDLE9BQU8sQ0FBd0IsdUJBQXVCLENBQUMsQ0FBQztJQUUxRyxNQUFNLENBQUMsV0FBVyxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDMUMsTUFBTSxDQUFDLElBQUksQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO0lBRWxELElBQUksQ0FBQztRQUNELDBCQUEwQjtRQUMxQixNQUFNLFVBQVUsR0FBRyxNQUFNLHFCQUFxQixDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFFdkUseUJBQXlCO1FBQ3pCLE1BQU0scUJBQXFCLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFOUQsT0FBTztZQUNILFVBQVUsRUFBRSxHQUFHO1lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQ2pCLE9BQU8sRUFBRSxvQ0FBb0M7Z0JBQzdDLEtBQUssRUFBRSxVQUFVLENBQUMsTUFBTTthQUMzQixDQUFDO1NBQ0wsQ0FBQztJQUVOLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2IsTUFBTSxDQUFDLFlBQVksQ0FBQyxvQ0FBb0MsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNqRSxNQUFNLEtBQUssQ0FBQztJQUNoQixDQUFDO1lBQVMsQ0FBQztRQUNQLE1BQU0sYUFBYSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxJQUFJLENBQUMsMkJBQTJCLENBQUMsQ0FBQztJQUM3QyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBL0JXLFFBQUEsT0FBTyxXQStCbEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xyXG5pbXBvcnQgeyBDb250ZXh0LCBTY2hlZHVsZWRFdmVudCB9IGZyb20gJ2F3cy1sYW1iZGEnO1xyXG5pbXBvcnQgeyBEZXBlbmRlbmN5Q29udGFpbmVyIH0gZnJvbSAnLi9mcmFtZXdvcmsvZGVwZW5kZW5jeS1jb250YWluZXIuZnJhbWV3b3JrJztcclxuaW1wb3J0IHsgQmVzdFBlcmZvcm1lcnNTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9iZXN0LXBlcmZvcm1lcnMuc2VydmljZSc7XHJcbmltcG9ydCB7IE1vbmdvRGJDbGllbnQgfSBmcm9tICdAc2hhcmVkL3NyYy9jbGllbnRzL21vbmdvZGIuY2xpZW50JztcclxuaW1wb3J0IHsgTG9nZ2VyU2VydmljZSB9IGZyb20gJ0BzaGFyZWQvc3JjL3NlcnZpY2VzL2xvZ2dlci5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gYXN5bmMgKGV2ZW50OiBTY2hlZHVsZWRFdmVudCwgY29udGV4dDogQ29udGV4dCkgPT4ge1xyXG4gICAgLy8gUmVzb2x2ZSBkZXBlbmRlbmNpZXMgZnJvbSBjb250YWluZXJcclxuICAgIGNvbnN0IGxvZ2dlciA9IERlcGVuZGVuY3lDb250YWluZXIucmVzb2x2ZTxMb2dnZXJTZXJ2aWNlPignTG9nZ2VyU2VydmljZScpO1xyXG4gICAgY29uc3QgbW9uZ29EYkNsaWVudCA9IERlcGVuZGVuY3lDb250YWluZXIucmVzb2x2ZTxNb25nb0RiQ2xpZW50PignTW9uZ29EYkNsaWVudCcpO1xyXG4gICAgY29uc3QgYmVzdFBlcmZvcm1lcnNTZXJ2aWNlID0gRGVwZW5kZW5jeUNvbnRhaW5lci5yZXNvbHZlPEJlc3RQZXJmb3JtZXJzU2VydmljZT4oJ0Jlc3RQZXJmb3JtZXJzU2VydmljZScpO1xyXG5cclxuICAgIGxvZ2dlci5zZXRUYXNrTmFtZSgnTFNFLUJlc3QtUGVyZm9ybWVycycpO1xyXG4gICAgbG9nZ2VyLmluZm8oJ0xTRSBCZXN0IFBlcmZvcm1lcnMgTGFtYmRhIHN0YXJ0ZWQnKTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIEFuYWx5emUgYmVzdCBwZXJmb3JtZXJzXHJcbiAgICAgICAgY29uc3QgcGVyZm9ybWVycyA9IGF3YWl0IGJlc3RQZXJmb3JtZXJzU2VydmljZS5hbmFseXplQmVzdFBlcmZvcm1lcnMoKTtcclxuXHJcbiAgICAgICAgLy8gUHVibGlzaCByZXN1bHRzIHRvIFNOU1xyXG4gICAgICAgIGF3YWl0IGJlc3RQZXJmb3JtZXJzU2VydmljZS5wdWJsaXNoQmVzdFBlcmZvcm1lcnMocGVyZm9ybWVycyk7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHN0YXR1c0NvZGU6IDIwMCxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0Jlc3QgcGVyZm9ybWVycyBhbmFseXNpcyBjb21wbGV0ZWQnLFxyXG4gICAgICAgICAgICAgICAgY291bnQ6IHBlcmZvcm1lcnMubGVuZ3RoXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGxvZ2dlci5lcnJvck1lc3NhZ2UoYEVycm9yIGluIGJlc3QgcGVyZm9ybWVycyBsYW1iZGE6ICR7ZXJyb3J9YCk7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIGF3YWl0IG1vbmdvRGJDbGllbnQuY2xvc2VDb25uZWN0aW9uKCk7XHJcbiAgICAgICAgbG9nZ2VyLmluZm8oJ01vbmdvREIgY29ubmVjdGlvbiBjbG9zZWQnKTtcclxuICAgIH1cclxufTtcclxuIl19